<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محطات شركة الكهرباء الوطنية (NEPCO)</title>

    <!-- LeafletJS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Cairo for Arabic text -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        #map {
            flex-grow: 1;
            height: 100%;
            transition: margin-right 0.3s ease-in-out;
            margin-right: 0;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out, margin-right 0.3s ease-in-out;
        }
        #map.active {
            opacity: 1;
            visibility: visible;
        }

        #sidebar {
            width: 100vw;
            max-width: 320px;
            height: 100%;
            background-color: #f8fafc;
            border-left: 1px solid #e2e8f0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 0;
            right: 0;
            z-index: 1001;
            transform: translateX(100%);
            visibility: hidden;
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0s 0.3s;
        }
        #sidebar.visible {
            visibility: visible;
            opacity: 1;
            transform: translateX(0);
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        #sidebar-header {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        #sidebar-content {
            padding: 16px;
            flex-grow: 1;
        }

        #sidebar-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1002;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: block;
            visibility: hidden;
            opacity: 0;
            transition: right 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0s 0.3s;
        }
        #sidebar-toggle.visible {
            visibility: visible;
            opacity: 1;
            transition: right 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        @media (min-width: 768px) {
            #sidebar {
                width: 320px;
            }
        }
        
        .filter-option {
            margin-bottom: 12px;
            display: flex;
            flex-direction: column;
        }
        .filter-option label {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            margin-bottom: 0;
            width: 100%;
            box-sizing: border-box;
        }
        .filter-option input[type="checkbox"] {
            margin-left: 12px;
            width: 18px;
            height: 18px;
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }
        .custom-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 4px;
            display: inline-block;
            margin-left: 12px;
            position: relative;
            flex-shrink: 0;
        }
        .custom-checkbox::after {
            content: '';
            width: 12px;
            height: 12px;
            background: #3b82f6;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            border-radius: 2px;
            transition: transform 0.2s ease-in-out;
        }
        .filter-option input[type="checkbox"]:checked + label .custom-checkbox::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .filter-option input[type="checkbox"]:checked + label span {
            font-weight: 700;
        }
        .filter-option label:hover {
            background-color: #f1f5f9;
        }
        .lightning-icon-marker {
            width: 28px;
            height: 28px;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .lightning-icon-marker svg {
            width: 20px;
            height: 20px;
            display: block;
        }

        .lightning-icon-sidebar-wrapper {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            margin-left: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .lightning-icon-sidebar-wrapper svg {
            width: 20px;
            height: 20px;
            display: block;
        }

        .station-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out;
            box-sizing: border-box;
        }
        .filter-option.expanded .station-list {
            max-height: 500px;
            border-top: 1px solid #e2e8f0;
        }
        .station-list li {
            padding: 8px 12px;
            padding-right: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 16px;
            border-top: 1px solid #edf2f7;
        }
        .station-list li:first-child {
            border-top: none;
        }
        .station-list li:hover {
            background-color: #e0f2fe;
            color: #0c4a6e;
        }

        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 1rem;
            padding: 1.5rem;
            background-color: #ffffff;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            max-width: 300px;
            min-width: 250px;
        }
        .custom-popup .leaflet-popup-content {
            margin: 0;
            text-align: center;
        }
        .custom-popup .popup-title {
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }
        .custom-popup .popup-description {
            font-size: 0.95rem;
            color: #4b5563;
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        .custom-popup .nav-link {
            display: inline-block;
            padding: 0.75rem 1.25rem;
            background-color: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
        }
        .custom-popup .nav-link:hover {
            background-color: #2563eb;
        }

        #map-selector-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.3s ease-in-out;
        }
        #map-selector-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #map-selector-content {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }
        #map-selector-modal.hidden #map-selector-content {
            transform: translateY(-50px);
        }
        #map-selector-content h2 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #1f2937;
        }
        .map-option-button {
            display: block;
            width: 100%;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .map-option-button:hover:not(:disabled) {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        .map-option-button:last-child {
            margin-bottom: 0;
        }
        .map-option-button:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Custom Copyright Style */
        #custom-copyright {
            position: absolute;
            bottom: 10px;
            left: 50%; /* Center horizontally */
            transform: translateX(-50%); /* Adjust for true centering */
            z-index: 1000;
            color: #4b5563;
            font-size: 1rem; /* Increased font size */
            background-color: rgba(255, 255, 255, 0.7);
            padding: 4px 8px;
            border-radius: 4px;
            pointer-events: none;
            line-height: 1.2; 
            white-space: nowrap; /* Prevent text wrapping */
        }

        /* Leaflet Control Layer Custom Position */
        .leaflet-control-layers.leaflet-bottom.leaflet-left {
            bottom: 100px !important; /* Adjusted to be higher up, above copyright */
            left: 10px !important;
            font-size: 1.125rem; /* Increased font size for layers control */
        }

    </style>
</head>
<body>

    <div id="map-selector-modal">
        <div id="map-selector-content">
            <h2>اختر طريقة عرض الخريطة</h2>
            <button class="map-option-button" data-map-type="terrain" disabled>خريطة التضاريس</button>
            <button class="map-option-button" data-map-type="streets" disabled>خريطة الشوارع</button>
            <button class="map-option-button" data-map-type="satellite" disabled>القمر الصناعي (شوارع وعلامات)</button>
            <hr class="my-6 border-gray-300"> 
            <div class="mt-4 text-sm text-gray-600">Designed by Mazen Makhoul</div>
        </div>
    </div>

    <div id="sidebar">
        <div id="sidebar-header">
            <h1 class="text-xl font-bold text-center text-gray-800">محطات شركة الكهرباء الوطنية (NEPCO)</h1>
        </div>
        <div id="sidebar-content">
            <div id="filter-container">
                <!-- Filter options will be inserted here -->
            </div>
            <div class="mt-4 flex flex-col space-y-2">
                <button id="show-all-btn" class="map-option-button bg-green-500 hover:bg-green-600">إظهار الكل</button>
                <button id="hide-all-btn" class="map-option-button bg-red-500 hover:bg-red-600">إخفاء الكل</button>
            </div>
        </div>
    </div>

    <button id="sidebar-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>

    <div id="map"></div>

    <div id="custom-copyright">
        Developed by Mazen Makhoul
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        const stationsData = [
            // صيانة الشرق
            { id: "alrisha400", name: "محطة الريشة 400", region: "صيانة الشرق", coords: [32.5689, 39.0141471], description: "400 ك.ف" },
            { id: "alrisha11_132", name: "محطة الريشة (11/132) ك.ف", region: "صيانة الشرق", coords: [32.572323, 39.0107256], description: "( 11/132 ) ك.ف" },
            { id: "alruwaished", name: "محطة الرويشد", region: "صيانة الشرق", coords: [32.4951511, 38.1965012], description: "( 33/132 ) ك.ف" },
            { id: "alsafawi", name: "محطة الصفاوي", region: "صيانة الشرق", coords: [32.1987671, 37.1177781], description: "( 33/132 ) ك.ف" },
            { id: "alsafawisolar", name: "محطة الصفاوي الشمسية", region: "صيانة الشرق", coords: [32.0936842, 37.024402], description: "132 ك.ف" },
            { id: "alazraq", name: "محطة الازرق", region: "صيانة الشرق", coords: [31.8702305, 36.7655758], description: "( 33/132 /11 ) ك.ف" },
            { id: "alethaa", name: "محطة الاذاعة", region: "صيانة الشرق", coords: [31.7306144, 36.4573091], description: "( 33/132 ) ك.ف" },
            { id: "almwaqarind", name: "محطة الموقر الصناعية", region: "صيانة الشرق", coords: [31.7922558, 36.227272], description: "( 33/132 ) ك.ف" },
            { id: "alhizam", name: "محطة الحزام", region: "صيانة الشرق", coords: [31.9903638, 36.0469029], description: "( 33/132 ) ك.ف" },

            // صيانة الشمال
            { id: "subha", name: "محطة صبحا", region: "صيانة الشمال", coords: [32.2622558, 36.4787577], description: "( 33/132 ) ك.ف" },
            { id: "aldhlail", name: "محطة الضليل", region: "صيانة الشمال", coords: [32.1446554, 36.272777], description: "( 33/132 ) ك.ف" },
            { id: "alrajhi", name: "محطة الراجحي", region: "صيانة الشمال", coords: [32.2112911, 36.201504], description: "( 33/132 ) ك.ف" },
            { id: "almafraq", name: "محطة المفرق", region: "صيانة الشمال", coords: [32.3870731, 36.2701028], description: "( 33/132 ) ك.ف" },
            { id: "alhassanind", name: "محطة الحسن الصناعية", region: "صيانة الشمال", coords: [32.4941724, 36.0276408], description: "( 33/132 ) ك.ف" },
            { id: "rehab", name: "محطة رحاب", region: "صيانة الشمال", coords: [32.3306337, 36.0521033], description: "( 33/132 ) ك.ف" },
            { id: "ishtafina", name: "محطة اشتفينا", region: "صيانة الشمال", coords: [32.3588574, 35.777843], description: "( 33/132 ) ك.ف" },
            { id: "waqas", name: "محطة وقاص", region: "صيانة الشمال", coords: [32.5508877, 35.6607739], description: "( 33/132 ) ك.ف" },
            { id: "eastirbid", name: "محطة شرق اربد", region: "صيانة الشمال", coords: [32.556473, 35.9077008], description: "( 33/132 ) ك.ف" },
            { id: "irbid", name: "محطة اربد", region: "صيانة الشمال", coords: [32.5344734, 35.8666052], description: "( 33/132 ) ك.ف" },

            // صيانة العقبة
            { id: "alquwairasolar", name: "محطة القويرة الشمسية", region: "صيانة العقبة", coords: [29.7282628, 35.3545944], description: "132 ك.ف" },
            { id: "alquwaira", name: "محطة القويرة", region: "صيانة العقبة", coords: [29.7163417, 35.2954441], description: "132 ك.ف" },
            { id: "aqabaind", name: "محطة العقبة الصناعية", region: "صيانة العقبة", coords: [29.59594, 35.0413122], description: "132 ك.ف" },
            { id: "aqabaA2", name: "محطة العقبة A2", region: "صيانة العقبة", coords: [29.5506402, 35.0282299], description: "132 ك.ف" },
            { id: "seacable400", name: "محطة الكبل البحري 400", region: "صيانة العقبة", coords: [29.432296, 34.9772449], description: "400 ك.ف" },
            { id: "aqabathermal", name: "محطة العقبة الحرارية", region: "صيانة العقبة", coords: [29.379168, 34.9765758], description: "132 ك.ف" },
            { id: "aqabathermal400", name: "محطة العقبة الحرارية 400", region: "صيانة العقبة", coords: [29.3791715, 34.9768883], description: "400 ك.ف" },

            // صيانة الكرك
            { id: "alatarat400", name: "محطة العطارات 400", region: "صيانة الكرك", coords: [31.268596, 36.4451965], description: "400 ك.ف" },
            { id: "alqatranah400", name: "محطة القطرانة 400", region: "صيانة الكرك", coords: [31.2187445, 36.0173106], description: "400 ك.ف" },
            { id: "alqatranah", name: "محطة القطرانة", region: "صيانة الكرك", coords: [31.2191069, 36.0174555], description: "132 ك.ف" },
            { id: "newkarak", name: "محطة الكرك الجديدة", region: "صيانة الكرك", coords: [31.1628214, 35.7384468], description: "132 ك.ف" },
            { id: "oldkarak", name: "محطة الكرك القديمة", region: "صيانة الكرك", coords: [31.1703272, 35.7246764], description: "132 ك.ف" },
            { id: "qatranacement", name: "محطة اسمنت القطرانة", region: "صيانة الكرك", coords: [31.1879033, 36.0712772], description: "132 ك.ف" },
            { id: "hadeethacement", name: "محطة اسمنت الحديثة", region: "صيانة الكرك", coords: [31.3340538, 36.1233459], description: "132 ك.ف" },
            { id: "ghoursafi", name: "محطة غور الصافي", region: "صيانة الكرك", coords: [31.0939395, 35.5186223], description: "132 ك.ف" },
            { id: "alhassa", name: "محطة الحسا", region: "صيانة الكرك", coords: [30.8346303, 36.025466], description: "132 ك.ف" },
            { id: "mas", name: "محطة ماس", region: "صيانة الكرك", coords: [30.7459217, 35.7758451], description: "132 ك.ف" },
            { id: "zainel", name: "محطة زينيل", region: "صيانة الكرك", coords: [30.7803224, 35.6748431], description: "132 ك.ف" },

            // صيانة الوسط
            { id: "southamman", name: "محطة جنوب عمان", region: "صيانة الوسط", coords: [31.8934973, 35.9065728], description: "132 ك.ف" },
            { id: "southamman400", name: "محطة جنوب عمان 400", region: "صيانة الوسط", coords: [31.8930828, 35.9068073], description: "400 ك.ف" },
            { id: "eastammanipp4", name: "محطة شرق عمان IPP4", region: "صيانة الوسط", coords: [31.9001749, 36.0829251], description: "132 ك.ف" },
            { id: "eastammanipp1_400", name: "محطة شرق عمان IPP1 400", region: "صيانة الوسط", coords: [31.8967146, 36.0822113], description: "400 ك.ف" },
            { id: "eastammanipp3_400", name: "محطة شرق عمان IPP3 400", region: "صيانة الوسط", coords: [31.9069535, 36.1802923], description: "400 ك.ف" },
            { id: "masdar", name: "محطة مصدر", region: "صيانة الوسط", coords: [31.8668281, 36.2023123], description: "132 ك.ف" },
            { id: "almwaqar", name: "محطة الموقر", region: "صيانة الوسط", coords: [31.7972585, 36.1277357], description: "132 ك.ف" },
            { id: "airportqh", name: "محطة المطار QH", region: "صيانة الوسط", coords: [31.7182405, 35.9429273], description: "132 ك.ف" },
            { id: "airport400", name: "محطة المطار 400", region: "صيانة الوسط", coords: [31.7168188, 35.9426379], description: "400 ك.ف" },
            { id: "airportql2", name: "محطة المطار QL2", region: "صيانة الوسط", coords: [31.7214744, 35.9753382], description: "132 ك.ف" },
            { id: "kfw", name: "محطة KFW", region: "صيانة الوسط", coords: [31.6651416, 35.9098554], description: "132 ك.ف" },
            { id: "southmadaba", name: "محطة جنوب مادبا", region: "صيانة الوسط", coords: [31.6868185, 35.783141], description: "132 ك.ف" },
            { id: "sahab", name: "محطة سحاب", region: "صيانة الوسط", coords: [31.8460718, 36.0116901], description: "132 ك.ف" },
            { id: "almanara", name: "محطة المنارة", region: "صيانة الوسط", coords: [31.8958916, 35.9931905], description: "132 ك.ف" },
            { id: "alashrafieh", name: "محطة الاشرفية", region: "صيانة الوسط", coords: [31.9359841, 35.9470286], description: "132 ك.ف" },
            { id: "marka", name: "محطة ماركا", region: "صيانة الوسط", coords: [31.9789979, 35.9710492], description: "132 ك.ف" },
            { id: "abdoun", name: "محطة عبدون", region: "صيانة الوسط", coords: [31.9403812, 35.8997782], description: "132 ك.ف" },
            { id: "citycenter", name: "محطة مركز المدينة", region: "صيانة الوسط", coords: [31.9694593, 35.9107755], description: "132 ك.ف" },
            { id: "university", name: "محطة الجامعة", region: "صيانة الوسط", coords: [31.9978813, 35.874366], description: "132 ك.ف" },
            { id: "tareq", name: "محطة طارق", region: "صيانة الوسط", coords: [32.0066724, 35.9192683], description: "132 ك.ف" },
            { id: "northamman", name: "محطة شمال عمان", region: "صيانة الوسط", coords: [32.0368455, 35.9591142], description: "132 ك.ف" },
            { id: "northamman400", name: "محطة شمال عمان 400", region: "صيانة الوسط", coords: [32.0368501, 35.9598384], description: "400 ك.ف" },
            { id: "newbayader", name: "محطة البيادر الجديدة", region: "صيانة الوسط", coords: [31.961052, 35.8455887], description: "132 ك.ف" },
            { id: "oldbayader", name: "محطة البيادر القديمة", region: "صيانة الوسط", coords: [31.9605655, 35.8461629], description: "132 ك.ف" },
            { id: "fuheis", name: "محطة الفحيص", region: "صيانة الوسط", coords: [31.9982009, 35.7851051], description: "132 ك.ف" },
            { id: "alsalt", name: "محطة السلط", region: "صيانة الوسط", coords: [32.0343688, 35.7771068], description: "132 ك.ف" },
            { id: "alsubaihi", name: "محطة الصبيحي", region: "صيانة الوسط", coords: [32.1361993, 35.7026854], description: "132 ك.ف" },
            { id: "westamman400", name: "محطة غرب عمان 400", region: "صيانة الوسط", coords: [31.9634258, 35.5885051], description: "400 ك.ف" },
            { id: "alrama", name: "محطة الرامة", region: "صيانة الوسط", coords: [31.8025035, 35.5632573], description: "132 ك.ف" },
            { id: "suwaimah", name: "محطة سويمة", region: "صيانة الوسط", coords: [31.6898144, 35.5807433], description: "132 ك.ف" },

            // صيانة معان
            { id: "kozbo", name: "محطة كوزبو", region: "صيانة معان", coords: [30.7358912, 35.6622041], description: "132 ك.ف" },
            { id: "tafilehwind", name: "محطة رياح الطفيلة", region: "صيانة معان", coords: [30.7103676, 35.6857937], description: "132 ك.ف" },
            { id: "alrashadiya", name: "محطة الرشادية", region: "صيانة معان", coords: [30.6743242, 35.6382227], description: "132 ك.ف" },
            { id: "alfjaig", name: "محطة الفجيج", region: "صيانة معان", coords: [30.5590708, 35.6391971], description: "132 ك.ف" },
            { id: "tafilehcity", name: "محطة مدينة الطفيلة (العيص)", region: "صيانة معان", coords: [30.8242444, 35.6401092], description: "132 ك.ف" },
            { id: "newmaan400", name: "محطة تحويل معان الجديدة 400", region: "صيانة معان", coords: [30.3113654, 35.7776431], description: "400 ك.ف" },
            { id: "newmaan", name: "محطة معان الجديدة", region: "صيانة معان", coords: [30.3102493, 35.7765649], description: "132 ك.ف" },
            { id: "maan", name: "محطة معان", region: "صيانة معان", coords: [30.2068049, 35.7285631], description: "132 ك.ف" },
            { id: "alhusseinuni", name: "محطة جامعة الحسين", region: "صيانة معان", coords: [30.2506879, 35.6949856], description: "132 ك.ف" },
            { id: "maansolar", name: "محطة معان الشمسية", region: "صيانة معان", coords: [30.1579119, 35.8155303], description: "132 ك.ف" },
            { id: "alshidiya", name: "محطة الشيدية", region: "صيانة معان", coords: [29.930958, 36.1350069], description: "132 ك.f" },
            { id: "aldeesi", name: "محطة الديسي", region: "صيانة معان", coords: [29.4471293, 35.8254278], description: "132 ك.ف" },
            { id: "alrajef", name: "محطة الراجف", region: "صيانة معان", coords: [30.157497, 35.4375926], description: "132 ك.ف" }
        ];

        let map;
        let esriTopo, openStreetMap, googleHybrid;
        let mapLayers = {};
        const markers = {};

        const LIGHTNING_SVG_PATH = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`;

        const regions = {};
        const customRegionOrder = ["صيانة الشمال", "صيانة الشرق", "صيانة الوسط", "صيانة الكرك", "صيانة معان", "صيانة العقبة"];
        const colors = ['#3b82f6', '#22c55e', '#f97316', '#a855f7', '#ef4444', '#00bcd4', '#ffc107', '#9e9e9e'];
        
        customRegionOrder.forEach((regionName, index) => {
            regions[regionName] = { color: colors[index % colors.length], layer: L.layerGroup() };
        });

        const stationsByRegion = stationsData.reduce((acc, station) => {
            if (!acc[station.region]) acc[station.region] = [];
            acc[station.region].push(station);
            return acc;
        }, {});

        stationsData.forEach(station => {
            const regionInfo = regions[station.region];
            if (!regionInfo) return;
            const colorIcon = L.divIcon({
                className: 'custom-div-icon',
                html: `<div class="lightning-icon-marker" style="background-color:${regionInfo.color};">${LIGHTNING_SVG_PATH}</div>`,
                iconSize: [28, 28], iconAnchor: [14, 14]
            });
            const popupContent = `
                <div class="custom-popup">
                    <div class="popup-title">${station.name}</div>
                    <p class="popup-description">${station.description}</p>
                    <a href="https://www.google.com/maps?q=${station.coords[0]},${station.coords[1]}" target="_blank" class="nav-link">توجه إلى الموقع</a>
                </div>
            `;
            const marker = L.marker(station.coords, { icon: colorIcon }).bindPopup(popupContent, { className: 'custom-popup' });
            regionInfo.layer.addLayer(marker);
            markers[station.id] = marker;
        });

        const filterContainer = document.getElementById('filter-container');
        customRegionOrder.forEach(regionName => {
            const regionInfo = regions[regionName];
            if (!regionInfo) return;

            const option = document.createElement('div');
            option.className = 'filter-option';
            const checkboxId = `${regionName.replace(/\s/g, '')}-checkbox`;

            let stationListHTML = '<ul class="station-list">';
            const stationsInCurrentRegion = stationsByRegion[regionName] || []; 
            stationsInCurrentRegion.forEach(station => {
                if(station.name) {
                    stationListHTML += `<li data-station-id="${station.id}">${station.name}</li>`;
                }
            });
            stationListHTML += '</ul>';

            option.innerHTML = `
                <input type="checkbox" id="${checkboxId}" name="region-filter" value="${regionName}">
                <label for="${checkboxId}">
                    <div class="custom-checkbox"></div>
                    <div class="lightning-icon-sidebar-wrapper" style="background-color: ${regionInfo.color};">
                        ${LIGHTNING_SVG_PATH}
                    </div>
                    <span>${regionName}</span>
                </label>
                ${stationListHTML}
            `;
            filterContainer.appendChild(option);
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            const mapSelectorModal = document.getElementById('map-selector-modal');
            const mapOptionButtons = document.querySelectorAll('.map-option-button[data-map-type]');
            
            esriTopo = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri'
            });
            openStreetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            });
            googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
                maxZoom: 20,
                subdomains:['mt0','mt1','mt2','mt3'],
                attribution: 'Map data &copy;2024 Google'
            });
            
            mapLayers = {
                "خريطة التضاريس": esriTopo,
                "خريطة الشوارع": openStreetMap,
                "القمر الصناعي": googleHybrid
            };

            mapOptionButtons.forEach(button => button.disabled = false);

            map = L.map('map', {
                center: [31.0, 37.0],
                zoom: 7,
                zoomControl: false
            });
            L.control.zoom({ position: 'topleft' }).addTo(map);

            L.control.layers(mapLayers, {}, { position: 'bottomleft', collapsed: false }).addTo(map);

            mapOptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const mapType = button.getAttribute('data-map-type');
                    Object.values(mapLayers).forEach(layer => {
                        if (map.hasLayer(layer)) map.removeLayer(layer);
                    });
                    if (mapType === 'terrain') esriTopo.addTo(map);
                    if (mapType === 'streets') openStreetMap.addTo(map);
                    if (mapType === 'satellite') googleHybrid.addTo(map);
                    mapSelectorModal.classList.add('hidden');
                    document.getElementById('map').classList.add('active');
                    document.getElementById('sidebar').classList.add('visible');
                    document.getElementById('sidebar-toggle').classList.add('visible');
                    setTimeout(() => map.invalidateSize(), 300);
                });
            });

            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const mapContainer = document.getElementById('map');
            const sidebarWidth = 320;

            sidebarToggle.addEventListener('click', () => {
                const isVisible = sidebar.classList.toggle('visible');
                if (window.innerWidth >= 768) {
                    if (isVisible) {
                        mapContainer.style.marginRight = `${sidebarWidth}px`;
                        sidebarToggle.style.right = `${sidebarWidth + 15}px`;
                    } else {
                        mapContainer.style.marginRight = '0';
                        sidebarToggle.style.right = '15px';
                    }
                    setTimeout(() => map.invalidateSize(), 300);
                }
            });

            const checkboxes = document.querySelectorAll('input[name="region-filter"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const regionName = checkbox.value;
                    if (regions[regionName]) {
                        if (checkbox.checked) {
                            if (!map.hasLayer(regions[regionName].layer)) {
                                map.addLayer(regions[regionName].layer);
                            }
                        } else {
                            if (map.hasLayer(regions[regionName].layer)) {
                                map.removeLayer(regions[regionName].layer);
                            }
                        }
                    }
                });
            });
            
            document.getElementById('show-all-btn').addEventListener('click', () => {
                checkboxes.forEach(cb => {
                    if (!cb.checked) {
                        cb.checked = true;
                        const event = new Event('change');
                        cb.dispatchEvent(event);
                    }
                });
                document.getElementById('show-all-btn').disabled = true;
                document.getElementById('show-all-btn').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('hide-all-btn').disabled = false;
                document.getElementById('hide-all-btn').classList.remove('opacity-50', 'cursor-not-allowed');
            });

            document.getElementById('hide-all-btn').addEventListener('click', () => {
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        cb.checked = false;
                        const event = new Event('change');
                        cb.dispatchEvent(event);
                    }
                });
                document.getElementById('hide-all-btn').disabled = true;
                document.getElementById('hide-all-btn').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('show-all-btn').disabled = false;
                document.getElementById('show-all-btn').classList.remove('opacity-50', 'cursor-not-allowed');
            });

            filterContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'LI') {
                    const stationId = e.target.dataset.stationId;
                    const station = stationsData.find(s => s.id === stationId);
                    if (station) {
                        const marker = markers[stationId];
                        if (marker) {
                            if (map) { 
                                map.flyTo(marker.getLatLng(), 15);
                                marker.openPopup();
                                // Close sidebar after clicking a station
                                if (window.innerWidth < 768) { 
                                    sidebar.classList.remove('visible');
                                } else {
                                    sidebar.classList.remove('visible');
                                    mapContainer.style.marginRight = '0';
                                    sidebarToggle.style.right = '15px';
                                }
                                setTimeout(() => map.invalidateSize(), 300);
                            }
                        }
                    }
                }
                 // Toggle expand/collapse for filter options when label is clicked
                if (e.target.tagName === 'LABEL' || e.target.closest('LABEL')) {
                    const label = e.target.closest('LABEL');
                    const filterOption = label.closest('.filter-option');
                    if (filterOption) {
                        filterOption.classList.toggle('expanded');
                    }
                }
            });

            // Initial state: "Show All" is enabled, "Hide All" is disabled
            document.getElementById('show-all-btn').disabled = false;
            document.getElementById('show-all-btn').classList.remove('opacity-50', 'cursor-not-allowed');
            document.getElementById('hide-all-btn').disabled = true;
            document.getElementById('hide-all-btn').classList.add('opacity-50', 'cursor-not-allowed');
        });
    </script>
</body>
</html>
